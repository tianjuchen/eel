<!DOCTYPE html><head><meta charset="UTF-8"><title>Adaptivity System | Stingray</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Stingray</a><a href="https://github.com/hugary1995/stingray" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="../../theory.html">Theory</a></li><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../examples.html">Examples</a></li><li><a href="../../stingray.html">Documentation</a></li></ul><a href="#" class="sidenav-trigger" data-target="f3430a14-8d9e-4f2e-9d23-9d22ce93b604"><i class="material-icons">menu</i></a><ul class="sidenav" id="f3430a14-8d9e-4f2e-9d23-9d22ce93b604"><li><a href="../../theory.html">Theory</a></li><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../examples.html">Examples</a></li><li><a href="../../stingray.html">Documentation</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">syntax</a><a href="." class="breadcrumb">Adaptivity</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="4abe8a92-2cdf-46cf-94fd-c9e83ddb6fbb" data-section-level="1" data-section-text="Adaptivity System"><h1 id="adaptivity-system">Adaptivity System</h1><p>MOOSE employs <span class="moose-katex-inline-equation" id="moose-equation-9eea313c-823d-4a8e-9db1-d3d8f2904d91"><script>var element = document.getElementById("moose-equation-9eea313c-823d-4a8e-9db1-d3d8f2904d91");katex.render("h", element, {displayMode:false,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\grad":"\\bs{\\nabla}","\\divergence":"\\grad \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\abs":"\\left\\lvert#1\\right\\rvert","\\diff":"\\text{ d}#1","\\bfa":"\\boldsymbol{a}","\\bfb":"\\boldsymbol{b}","\\bfc":"\\boldsymbol{c}","\\bfd":"\\boldsymbol{d}","\\bfe":"\\boldsymbol{e}","\\bff":"\\boldsymbol{f}","\\bfg":"\\boldsymbol{g}","\\bfh":"\\boldsymbol{h}","\\bfi":"\\boldsymbol{i}","\\bfj":"\\boldsymbol{j}","\\bfk":"\\boldsymbol{k}","\\bfl":"\\boldsymbol{l}","\\bfm":"\\boldsymbol{m}","\\bfn":"\\boldsymbol{n}","\\bfo":"\\boldsymbol{o}","\\bfp":"\\boldsymbol{p}","\\bfq":"\\boldsymbol{q}","\\bfr":"\\boldsymbol{r}","\\bfs":"\\boldsymbol{s}","\\bft":"\\boldsymbol{t}","\\bfu":"\\boldsymbol{u}","\\bfv":"\\boldsymbol{v}","\\bfw":"\\boldsymbol{w}","\\bfx":"\\boldsymbol{x}","\\bfy":"\\boldsymbol{y}","\\bfz":"\\boldsymbol{z}","\\bfA":"\\boldsymbol{A}","\\bfB":"\\boldsymbol{B}","\\bfC":"\\boldsymbol{C}","\\bfD":"\\boldsymbol{D}","\\bfE":"\\boldsymbol{E}","\\bfF":"\\boldsymbol{F}","\\bfG":"\\boldsymbol{G}","\\bfH":"\\boldsymbol{H}","\\bfI":"\\boldsymbol{I}","\\bfJ":"\\boldsymbol{J}","\\bfK":"\\boldsymbol{K}","\\bfL":"\\boldsymbol{L}","\\bfM":"\\boldsymbol{M}","\\bfN":"\\boldsymbol{N}","\\bfO":"\\boldsymbol{O}","\\bfP":"\\boldsymbol{P}","\\bfQ":"\\boldsymbol{Q}","\\bfR":"\\boldsymbol{R}","\\bfS":"\\boldsymbol{S}","\\bfT":"\\boldsymbol{T}","\\bfU":"\\boldsymbol{U}","\\bfV":"\\boldsymbol{V}","\\bfW":"\\boldsymbol{W}","\\bfX":"\\boldsymbol{X}","\\bfY":"\\boldsymbol{Y}","\\bfZ":"\\boldsymbol{Z}"}});</script></span>-adaptivity to automatically refine or coarsen the mesh in regions of high or low estimated solution error, respectively. The idea is to concentrate degrees of freedom (DOFs) where the error is highest, while reducing DOFs where the solution is already well-captured. This is achieved through splitting and joining elements from the original mesh based on an error <a href="Indicators/index.html"><code>Indicator</code></a>. Once an error has been computed, a <a href="Markers/index.html"><code>Marker</code></a> is used to decide which elements to refine or coarsen. Mesh adaptivity can be employed with both <code>Steady</code> and <code>Transient</code> Executioners.</p><section class="scrollspy" id="24e281ad-91f5-4f97-85a6-32557e0d6454" data-section-level="2" data-section-text="Refinement Patterns"><h2 id="refinement-patterns">Refinement Patterns</h2><p>MOOSE employs &quot;self-similar&quot;, isotropic refinement patterns, as shown in the figure. When an element is marked for refinement, it is split into elements of the same type. For example, when using Quad4 elements, four &quot;child&quot; elements are created when the element is refined. Coarsening happens in reverse, children are deleted and the &quot;parent&quot; element is reactivated. The original mesh starts at refinement level 0. Each time an element is split, the children are assigned a refinement level one higher than their parents.</p><div class="card moose-float"><div class="card-content"><picture class="materialboxed moose-image"><img src="../../large_media/framework/adaptivity.png"></img></picture><p class="moose-caption"><span class="moose-caption-text">Self-similar refinement pattern utilized by MOOSE for adaptivity for 1D linear,                2D quadrilatrel, and 3D hexahedron elements.</span></p></div></div></section><section class="scrollspy" id="a5117fb3-46bb-4382-8988-9f7c5bbac8b2" data-section-level="2" data-section-text="Cycles and Intervals"><h2 id="cycles-and-intervals">Cycles and Intervals</h2><p>MOOSE normally performs one adaptivity step per solve. However, developers have the ability to increase or decrease the amount of adaptivity performed through the &quot;cycles&quot; and &quot;interval&quot; parameters.</p><p>The &quot;cycles&quot; parameter can be set to perform multiple adaptivity cycles for a single solve. This is useful for cases where one would like to resolve a sharp feature in a single step, such as in the case of an introduced nucleus.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[./Adaptivity]
  refine_fraction = 0.3
  max_h_level = 7
  cycles_per_step = 2
[../]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#a2c36c2f-f6cc-4aeb-bfc4-695823c91c06">(moose/test/tests/mesh/adapt/adapt_test_cycles.i)</a><p>The &quot;interval&quot; parameter can be set to decrease the amount of adaptivity is performed so that it is performed on every _nth_ step. This can sometimes help to speed up your simulation as adaptivity can be somewhat expensive to perform.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[./Adaptivity]
  interval = 2
  refine_fraction = 0.2
  coarsen_fraction = 0.3
  max_h_level = 4
[../]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#4090beb1-72d2-4b04-8c2a-947424e376da">(moose/test/tests/mesh/adapt/interval.i)</a></section><section class="scrollspy" id="2b1df909-cabe-45f1-92ab-a5de1698172a" data-section-level="2" data-section-text="Input Parameters"><h2 id="input-parameters">Input Parameters</h2><ul class="collapsible" data-collapsible="expandable"><li><div class="collapsible-header"><span class="moose-parameter-name">active</span><span class="moose-parameter-header-default">__all__ </span><span class="moose-parameter-header-description">If specified only the blocks named will be visited and made active</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>__all__ </p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>If specified only the blocks named will be visited and made active</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">cycles_per_step</span><span class="moose-parameter-header-default">1</span><span class="moose-parameter-header-description">The number of adaptive steps to use when on each timestep during a Transient simulation.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The number of adaptive steps to use when on each timestep during a Transient simulation.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">inactive</span><span class="moose-parameter-header-description">If specified blocks matching these identifiers will be skipped.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector&lt;std::string&gt;</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>If specified blocks matching these identifiers will be skipped.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">initial_marker</span><span class="moose-parameter-header-description">The name of the Marker to use to adapt the mesh during initial refinement.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MarkerName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the Marker to use to adapt the mesh during initial refinement.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">initial_steps</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The number of adaptive steps to do based on the initial condition.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The number of adaptive steps to do based on the initial condition.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">interval</span><span class="moose-parameter-header-default">1</span><span class="moose-parameter-header-description">The number of time steps betweeen each adaptivity phase</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The number of time steps betweeen each adaptivity phase</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">marker</span><span class="moose-parameter-header-description">The name of the Marker to use to actually adapt the mesh.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>MarkerName</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The name of the Marker to use to actually adapt the mesh.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">max_h_level</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">Maximum number of times a single element can be refined. If 0 then infinite.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Maximum number of times a single element can be refined. If 0 then infinite.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">recompute_markers_during_cycles</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Recompute markers during adaptivity cycles</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>Recompute markers during adaptivity cycles</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">start_time</span><span class="moose-parameter-header-default">-1.79769e+308</span><span class="moose-parameter-header-description">The time that adaptivity will be active after.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>-1.79769e+308</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The time that adaptivity will be active after.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">steps</span><span class="moose-parameter-header-default">0</span><span class="moose-parameter-header-description">The number of adaptive steps to use when doing a Steady simulation.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The number of adaptive steps to use when doing a Steady simulation.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">stop_time</span><span class="moose-parameter-header-default">1.79769e+308</span><span class="moose-parameter-header-description">The time after which adaptivity will no longer be active.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>1.79769e+308</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description-controllable"><span>Controllable:</span>No</p><p class="moose-parameter-description"><span>Description:</span>The time after which adaptivity will no longer be active.</p></div></li></ul></section><section class="scrollspy" id="2d2c7e45-3366-44be-ad48-100a38858021" data-section-level="2" data-section-text="Available Subsystems"><h2 id="available-subsystems">Available Subsystems</h2><ul class="moose-syntax-list collection with-header"><li class="collection-header">Moose App</li><li class="collection-item"><a href="Indicators/index.html">Indicators</a></li><li class="collection-item"><a href="Markers/index.html">Markers</a></li></ul></section></section><div class="moose-modal modal" id="a2c36c2f-f6cc-4aeb-bfc4-695823c91c06"><div class="modal-content"><h4>(moose/test/tests/mesh/adapt/adapt_test_cycles.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  type = GeneratedMesh
  nx = 2
  ny = 2
  dim = 2
  uniform_refine = 3
[]

[Variables]
  active = &#x27;u v&#x27;

  [./u]
    order = FIRST
    family = LAGRANGE
  [../]

  [./v]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[Kernels]
  active = &#x27;udiff uconv uie vdiff&#x27;

  [./udiff]
    type = Diffusion
    variable = u
  [../]

  [./uconv]
    type = Convection
    variable = u
    velocity = &#x27;20 1 0&#x27;
  [../]

  [./uie]
    type = TimeDerivative
    variable = u
  [../]

  [./vdiff]
    type = Diffusion
    variable = v
  [../]
[]

[BCs]
  active = &#x27;uleft uright vleft vright&#x27;

  [./uleft]
    type = DirichletBC
    variable = u
    boundary = 3
    value = 0
  [../]

  [./uright]
    type = DirichletBC
    variable = u
    boundary = 1
    value = 1
  [../]

  [./vleft]
    type = DirichletBC
    variable = v
    boundary = 3
    value = 1
  [../]

  [./vright]
    type = DirichletBC
    variable = v
    boundary = 1
    value = 0
  [../]
[]

[Executioner]
  type = Transient

  solve_type = &#x27;PJFNK&#x27;

  start_time = 0.0
  num_steps = 2
  dt = .1

  [./Adaptivity]
    refine_fraction = 0.3
    max_h_level = 7
    cycles_per_step = 2
  [../]
[]

[Outputs]
  file_base = out_cycles
  exodus = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4090beb1-72d2-4b04-8c2a-947424e376da"><div class="modal-content"><h4>(moose/test/tests/mesh/adapt/interval.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  type = GeneratedMesh
  nx = 2
  ny = 2
  dim = 2
  uniform_refine = 3
[]

[Variables]
  active = &#x27;u v&#x27;

  [./u]
    order = FIRST
    family = LAGRANGE
  [../]

  [./v]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[Kernels]
  active = &#x27;udiff uconv uie vdiff vconv vie&#x27;

  [./udiff]
    type = Diffusion
    variable = u
  [../]

  [./uconv]
    type = Convection
    variable = u
    velocity = &#x27;10 1 0&#x27;
  [../]

  [./uie]
    type = TimeDerivative
    variable = u
  [../]

  [./vdiff]
    type = Diffusion
    variable = v
  [../]

  [./vconv]
    type = Convection
    variable = v
    velocity = &#x27;-10 1 0&#x27;
  [../]

  [./vie]
    type = TimeDerivative
    variable = v
  [../]
[]

[BCs]
  active = &#x27;uleft uright vleft vright&#x27;

  [./uleft]
    type = DirichletBC
    variable = u
    boundary = 3
    value = 0
  [../]

  [./uright]
    type = DirichletBC
    variable = u
    boundary = 1
    value = 1
  [../]

  [./vleft]
    type = DirichletBC
    variable = v
    boundary = 3
    value = 1
  [../]

  [./vright]
    type = DirichletBC
    variable = v
    boundary = 1
    value = 0
  [../]
[]

[Executioner]
  type = Transient

  solve_type = &#x27;PJFNK&#x27;

  start_time = 0.0
  num_steps = 4
  dt = .1

  [./Adaptivity]
    interval = 2
    refine_fraction = 0.2
    coarsen_fraction = 0.3
    max_h_level = 4
  [../]
[]

[Outputs]
  exodus = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#24e281ad-91f5-4f97-85a6-32557e0d6454" class="tooltipped" data-position="left" data-tooltip="Refinement Patterns">Refinement Patterns</a></li><li><a href="#a5117fb3-46bb-4382-8988-9f7c5bbac8b2" class="tooltipped" data-position="left" data-tooltip="Cycles and Intervals">Cycles and Intervals</a></li><li><a href="#2b1df909-cabe-45f1-92ab-a5de1698172a" class="tooltipped" data-position="left" data-tooltip="Input Parameters">Input Parameters</a></li><li><a href="#2d2c7e45-3366-44be-ad48-100a38858021" class="tooltipped" data-position="left" data-tooltip="Available Subsystems">Available Subsystems</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>